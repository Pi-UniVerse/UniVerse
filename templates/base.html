<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}UniVerse {% endblock %}</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
	<style>
		:root {
			--primary: #6366f1;
			--primary-dark: #4f46e5;
			--secondary: #ec4899;
			--success: #10b981;
			--danger: #ef4444;
			
			--bg-primary: #f5f7fa;
			--bg-secondary: #ffffff;
			--bg-tertiary: #f9fafb;
			--card-bg: rgba(255, 255, 255, 0.95);
			
			--text-primary: #1e293b;
			--text-secondary: #64748b;
			--text-muted: #94a3b8;
			
			--border: #e2e8f0;
			--border-light: #f1f5f9;
			
			--shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
			--shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
			--shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
			--shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
			--shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);
			
			--radius: 0.75rem;
			--radius-lg: 1rem;
			--radius-xl: 1.5rem;
			--radius-full: 9999px;
			
			--transition: all 0.2s ease;
			--transition-slow: all 0.3s ease;
			--navbar-height: 65px;
		}
		
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
			background: var(--bg-primary);
			color: var(--text-primary);
			line-height: 1.6;
			padding-top: var(--navbar-height);
		}
		
		/* ========== NAVBAR ========== */
		.navbar {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			height: var(--navbar-height);
			background: white;
			box-shadow: var(--shadow);
			z-index: 1000;
			border-bottom: 1px solid var(--border);
		}
		
		.nav-container {
			max-width: 1920px;
			margin: 0 auto;
			height: 100%;
			display: flex;
			align-items: center;
			padding: 0 2rem;
			gap: 2rem;
		}
		
		/* Logo */
		.nav-brand {
			display: flex;
			align-items: center;
			gap: 0.625rem;
			text-decoration: none;
			font-weight: 800;
			font-size: 1.375rem;
			color: var(--primary);
			flex-shrink: 0;
		}
		
		.brand-icon {
			font-size: 1.75rem;
		}
		
		.brand-text {
			background: linear-gradient(135deg, var(--primary), var(--secondary));
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}
		
		/* Central Search */
		.nav-search-center {
			flex: 1;
			max-width: 580px;
			margin: 0 auto;
		}
		
		.search-form {
			position: relative;
		}
		
		.search-icon {
			position: absolute;
			left: 1.125rem;
			top: 50%;
			transform: translateY(-50%);
			font-size: 1.125rem;
			color: var(--text-muted);
		}
		
		.search-input {
			width: 100%;
			padding: 0.75rem 1.125rem 0.75rem 3rem;
			border: 2px solid var(--border);
			border-radius: var(--radius-full);
			font-size: 0.9375rem;
			transition: var(--transition);
			background: var(--bg-primary);
		}
		
		.search-input:focus {
			outline: none;
			border-color: var(--primary);
			background: white;
			box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.08);
		}
		
		/* Icon Navigation */
		.nav-icons {
			display: flex;
			align-items: center;
			gap: 0.25rem;
			list-style: none;
			flex-shrink: 0;
		}
		
		.nav-icon-link {
			position: relative;
			display: flex;
			align-items: center;
			justify-content: center;
			width: 44px;
			height: 44px;
			border-radius: var(--radius-full);
			text-decoration: none;
			color: var(--text-secondary);
			transition: var(--transition);
		}
		
		.nav-icon-link:hover {
			background: var(--bg-primary);
			color: var(--primary);
		}
		
		.nav-icon-link.active {
			background: rgba(99, 102, 241, 0.1);
			color: var(--primary);
		}
		
		.nav-icon-link .icon {
			font-size: 1.375rem;
		}
		
		.badge {
			position: absolute;
			top: 6px;
			right: 6px;
			background: var(--danger);
			color: white;
			font-size: 0.6875rem;
			font-weight: 700;
			padding: 0.125rem 0.375rem;
			border-radius: var(--radius-full);
			min-width: 18px;
			text-align: center;
			border: 2px solid white;
		}
		
		/* User Menu */
		.user-menu-wrapper {
			position: relative;
		}
		
		.user-menu-btn {
			display: flex;
			align-items: center;
			gap: 0.5rem;
			padding: 0.375rem;
			background: none;
			border: 2px solid var(--border);
			border-radius: var(--radius-full);
			cursor: pointer;
			transition: var(--transition);
		}
		
		.user-menu-btn:hover {
			border-color: var(--primary);
			background: var(--bg-primary);
		}
		
		.user-avatar-small {
			width: 36px;
			height: 36px;
			border-radius: var(--radius-full);
			object-fit: cover;
		}
		
		.user-avatar-placeholder-small {
			width: 36px;
			height: 36px;
			border-radius: var(--radius-full);
			background: linear-gradient(135deg, var(--primary), var(--secondary));
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 700;
		}
		
		.dropdown-arrow {
			font-size: 0.625rem;
			color: var(--text-muted);
		}
		
		/* User Dropdown */
		.user-dropdown-menu {
			position: absolute;
			top: calc(100% + 0.25rem);  /* Reduced from 0.625rem */
			right: 0;
			min-width: 280px;
			background: white;
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-lg);
			border: 1px solid var(--border);
			padding: 0.5rem;
			display: none;
			z-index: 1001;
		}

		
		.user-menu-wrapper:hover .user-dropdown-menu {
			display: block;
			animation: slideDown 0.2s ease;
		}
		
		@keyframes slideDown {
			from {
				opacity: 0;
				transform: translateY(-10px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
		
		.dropdown-header {
			padding: 0.75rem;
			margin-bottom: 0.5rem;
		}
		
		.dropdown-user-info {
			display: flex;
			align-items: center;
			gap: 0.875rem;
		}
		
		.dropdown-avatar {
			width: 48px;
			height: 48px;
			border-radius: var(--radius-full);
			object-fit: cover;
		}
		
		.dropdown-avatar-placeholder {
			width: 48px;
			height: 48px;
			border-radius: var(--radius-full);
			background: linear-gradient(135deg, var(--primary), var(--secondary));
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: 700;
			font-size: 1.25rem;
		}
		
		.dropdown-name {
			font-weight: 700;
			color: var(--text-primary);
		}
		
		.dropdown-username {
			font-size: 0.875rem;
			color: var(--text-muted);
		}
		
		.dropdown-divider {
			height: 1px;
			background: var(--border);
			margin: 0.5rem 0;
		}
		
		.dropdown-item {
			display: flex;
			align-items: center;
			gap: 0.875rem;
			padding: 0.75rem 1rem;
			border-radius: var(--radius);
			text-decoration: none;
			color: var(--text-primary);
			font-weight: 500;
			transition: var(--transition);
		}
		
		.dropdown-item:hover {
			background: var(--bg-primary);
			color: var(--primary);
		}
		
		.dropdown-item.logout {
			color: var(--danger);
		}
		
		.dropdown-item.logout:hover {
			background: rgba(239, 68, 68, 0.1);
		}
		
		/* Flash Messages */
		.messages {
			position: fixed;
			top: calc(var(--navbar-height) + 1rem);
			right: 1rem;
			z-index: 1050;
			display: flex;
			flex-direction: column;
			gap: 0.75rem;
			max-width: 400px;
		}
		
		.messages-page {
			display: grid;
			grid-template-columns: 380px 1fr;
			height: calc(100vh - var(--navbar-height));
			max-width: 1920px;
			margin: 0 auto;
			background: var(--bg-primary);
			overflow: hidden; /* Prevent page scroll */
		}

		.message {
			display: flex;
			align-items: center;
			gap: 0.75rem;
			padding: 1rem 1.25rem;
			background: white;
			border-radius: var(--radius-lg);
			box-shadow: var(--shadow-lg);
			border-left: 4px solid;
			animation: slideInRight 0.3s ease;
			transition: var(--transition);
		}
		
		@keyframes slideInRight {
			from {
				opacity: 0;
				transform: translateX(100%);
			}
			to {
				opacity: 1;
				transform: translateX(0);
			}
		}
		
		.message.success {
			border-left-color: var(--success);
			color: var(--success);
		}
		
		.message.error {
			border-left-color: var(--danger);
			color: var(--danger);
		}
		
		.message.warning {
			border-left-color: #f59e0b;
			color: #f59e0b;
		}
		
		.message.info {
			border-left-color: var(--primary);
			color: var(--primary);
		}
		
		.message span:first-child {
			font-size: 1.25rem;
		}
		
		.message span:last-child {
			flex: 1;
			color: var(--text-primary);
			font-weight: 500;
		}
		
		/* Responsive */
		@media (max-width: 1024px) {
			.brand-text {
				display: none;
			}
			
			.nav-search-center {
				max-width: 400px;
			}
		}
		
		@media (max-width: 768px) {
			.nav-container {
				padding: 0 1rem;
				gap: 1rem;
			}
			
			.nav-search-center {
				display: none;
			}
			
			.nav-icons {
				gap: 0.125rem;
			}
			
			.nav-icon-link {
				width: 40px;
				height: 40px;
			}
			
			.messages {
				left: 1rem;
				right: 1rem;
				max-width: 100%;
			}
		}
		/* ========== MAIN CHAT WINDOW ========== */
		.chat-window {
			display: flex;
			flex-direction: column;
			background: var(--bg-secondary);
			height: 100%;
			max-height: calc(100vh - var(--navbar-height));
			overflow: hidden; /* Important: prevent window scroll */
		}

		/* Chat header */
		.chat-window-header {
			background: white;
			border-bottom: 1px solid var(--border);
			padding: 1rem 1.5rem;
			display: flex;
			align-items: center;
			justify-content: space-between;
			flex-shrink: 0;
			z-index: 10;
		}

		/* Messages area - FIXED HEIGHT */
		.messages-area {
			flex: 1;
			overflow-y: auto;
			overflow-x: hidden;
			padding: 1.5rem;
			display: flex;
			flex-direction: column;
			gap: 1rem;
			background: #f9fafb;
			min-height: 0; /* Important for flex scrolling */
		}

		/* Custom scrollbar for messages */
		.messages-area::-webkit-scrollbar {
			width: 8px;
		}

		.messages-area::-webkit-scrollbar-track {
			background: transparent;
		}

		.messages-area::-webkit-scrollbar-thumb {
			background: var(--border);
			border-radius: 4px;
		}

		.messages-area::-webkit-scrollbar-thumb:hover {
			background: var(--text-muted);
		}

		/* Input area */
		.chat-input-area {
			background: white;
			border-top: 1px solid var(--border);
			padding: 1rem 1.5rem;
			flex-shrink: 0;
		}
	</style>
    
    {% block extra_css %}{% endblock %}
</head>
<body {% if block.body_class %}class="{% block body_class %}{% endblock %}"{% endif %}>
    <!-- Navbar -->
	<nav class="navbar">
		<div class="nav-container">
			<!-- Logo -->
			<a href="{% url 'feed' %}" class="nav-brand">
				<span class="brand-icon">🌐</span>
				<span class="brand-text">UniVerse </span>
			</a>
			
			<!-- Central Search Bar -->
			<div class="nav-search-center">
				<form action="{% url 'search_users' %}" method="get" class="search-form">
					<span class="search-icon">🔍</span>
					<input type="text" name="q" placeholder="Search people, posts, videos..." class="search-input">
				</form>
			</div>
			
			<!-- Right Navigation Icons -->
			<ul class="nav-icons">
				{% if user.is_authenticated %}
					<li>
						<a href="{% url 'feed' %}" class="nav-icon-link {% if request.path == '/' %}active{% endif %}" title="Home">
							<span class="icon">🏠</span>
						</a>
					</li>
					
					<li>
						<a href="{% url 'videos_feed' %}" class="nav-icon-link {% if 'videos' in request.path or 'stories' in request.path %}active{% endif %}" title="Media">
							<span class="icon">🎬</span>
						</a>
					</li>
					
					<li>
						<a href="{% url 'groups_list' %}" class="nav-icon-link {% if 'groups' in request.path %}active{% endif %}" title="Groups">
							<span class="icon">👥</span>
						</a>
					</li>
					
					<li>
						<a href="{% url 'messages_list' %}" class="nav-icon-link {% if 'messages' in request.path %}active{% endif %}" title="Messages">
							<span class="icon">💬</span>
							{% if unread_messages_count > 0 %}
								<span class="badge">{{ unread_messages_count }}</span>
							{% endif %}
						</a>
					</li>
					
					<li>
						<a href="{% url 'notifications' %}" class="nav-icon-link {% if 'notifications' in request.path %}active{% endif %}" title="Notifications">
							<span class="icon">🔔</span>
							{% if unread_notifications_count > 0 %}
								<span class="badge">{{ unread_notifications_count }}</span>
							{% endif %}
						</a>
					</li>
					
					<li class="user-menu-wrapper">
						<button class="user-menu-btn">
							{% if user.profile.profile_picture %}
								<img src="{{ user.profile.profile_picture.url }}" alt="{{ user.username }}" class="user-avatar-small">
							{% else %}
								<div class="user-avatar-placeholder-small">{{ user.username|first|upper }}</div>
							{% endif %}
							<span class="dropdown-arrow">▼</span>
						</button>
						
						<div class="user-dropdown-menu">
							<div class="dropdown-header">
								<div class="dropdown-user-info">
									{% if user.profile.profile_picture %}
										<img src="{{ user.profile.profile_picture.url }}" alt="{{ user.username }}" class="dropdown-avatar">
									{% else %}
										<div class="dropdown-avatar-placeholder">{{ user.username|first|upper }}</div>
									{% endif %}
									<div>
										<div class="dropdown-name">{{ user.get_full_name|default:user.username }}</div>
										<div class="dropdown-username">@{{ user.username }}</div>
									</div>
								</div>
							</div>
							
							<div class="dropdown-divider"></div>
							
							<a href="{% url 'profile' user.username %}" class="dropdown-item">
								<span class="icon">👤</span>
								<span>My Profile</span>
							</a>
							<a href="{% url 'my_playlists' %}" class="dropdown-item">
								<span class="icon">📁</span>
								<span>My Playlists</span>
							</a>
							<a href="{% url 'edit_profile' %}" class="dropdown-item">
								<span class="icon">⚙️</span>
								<span>Settings</span>
							</a>
							
							<div class="dropdown-divider"></div>
							
							<a href="{% url 'logout' %}" class="dropdown-item logout">
								<span class="icon">🚪</span>
								<span>Logout</span>
							</a>
						</div>
					</li>
				{% else %}
					<!-- Not logged in - Show login/register -->
					<li>
						<a href="{% url 'login' %}" class="nav-icon-link">
							<span style="font-size: 0.9375rem; font-weight: 600;">Login</span>
						</a>
					</li>
					<li>
						<a href="{% url 'register' %}" class="nav-icon-link" style="background: var(--primary); color: white;">
							<span style="font-size: 0.9375rem; font-weight: 600;">Sign Up</span>
						</a>
					</li>
				{% endif %}
			</ul>
		</div>
	</nav>
	
    <!-- Flash Messages (Django Messages Framework) -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="message {{ message.tags }}">
            <span>
                {% if message.tags == 'success' %}✓
                {% elif message.tags == 'error' %}✗
                {% elif message.tags == 'warning' %}⚠️
                {% else %}ℹ️{% endif %}
            </span>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    
    <script>
        // Auto-hide messages after 5 seconds
        setTimeout(function() {
            const messages = document.querySelectorAll('.message');
            messages.forEach(function(message) {
                message.style.opacity = '0';
                message.style.transform = 'translateX(100%)';
                setTimeout(function() {
                    message.remove();
                }, 300);
            });
        }, 5000);
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>